#!/usr/bin/env python3
"""Build history.json from extracted YouTube data."""
import json
from datetime import datetime, timezone, timedelta
from collections import Counter
from pathlib import Path

# Raw data extracted from browser
RAW_VIDEOS = [{"title":"17:00","channel":"Dolly & Amigos em PortuguÃªs - Brasil","url":"https://www.youtube.com/watch?v=0Ve3lu9ZJ5k","duration_raw":"17:00","section_date":"Today","lines":["17:00","Dolly e Amigos Novos desenhos animados para crianÃ§as EpisÃ³dios engraÃ§ados #348 Full HD","Dolly & Amigos em PortuguÃªs - Brasil","37M views"]},{"title":"16:07","channel":"Great Quiz","url":"https://www.youtube.com/watch?v=wbR8eUYukEM","duration_raw":"16:07","section_date":"Today","lines":["16:07","Pinkfong Wonderstar Characters In REAL LIFE! | ðŸŽ¬ Favorite Movies, Foods ðŸ• & More | Hogi, Jeni...","Great Quiz","845K views"]},{"title":"15:39","channel":"Great Quiz","url":"https://www.youtube.com/watch?v=aPuyj7lKFpM&t=4s&pp=0gcJCaIKAYcqIYzv","duration_raw":"15:39","section_date":"Today","lines":["15:39","Robocar Poli Characters as Babies ðŸ‘¶ðŸ”¥ + Guess the Voice Quiz | Roy, Amber, Poli, Kevin, Jin...","Great Quiz","14K views"]},{"title":"15:26","channel":"Great Quiz","url":"https://www.youtube.com/watch?v=a5jBK5cXwb0&t=78s&pp=0gcJCaIKAYcqIYzv","duration_raw":"15:26","section_date":"Today","lines":["15:26","Little Baby Bum in REAL LIFE ðŸ‘©â­ + Guess The Voice Quiz ~ Mia, Max, Twinkle Twinkle Little Star...","Great Quiz","285K views"]},{"title":"10:14","channel":"Dolly's Stories KIDS","url":"https://www.youtube.com/watch?v=sb_LrzfFb8U&t=410s&pp=0gcJCaIKAYcqIYzv","duration_raw":"10:14","section_date":"Today","lines":["10:14","Dolly e Amigos Em PortuguÃªs Brasil Completo #1","Dolly's Stories KIDS","542M views"]},{"title":"2:58","channel":"Genki Park","url":"https://www.youtube.com/watch?v=Dx-LG3oCzSM&t=46s","duration_raw":"2:58","section_date":"Today","lines":["2:58","Sick Song | Cartoon for Kids | Nursery Rhymes | Healthy Habits | Genki Park | Be ill Song Toddlers","Genki Park","6.5M views"]},{"title":"7:21","channel":"Genki Park","url":"https://www.youtube.com/watch?v=xCJ8eHrNn88&t=122s","duration_raw":"7:21","section_date":"Today","lines":["7:21","Boo Boo Song | Healthy Meal | Sick Song | Healthy Habits | Toddlers | Nursery Rhymes | Germs | Kids","Genki Park","17M views"]},{"title":"7:01","channel":"Genki Park","url":"https://www.youtube.com/watch?v=jc4xVO_MIc4&t=2s","duration_raw":"7:01","section_date":"Today","lines":["7:01","Healthy Habits - Nursery Rhymes - Healthy Meal - Potty Training - Brush your teeth - Kids - Todlers","Genki Park","1M views"]},{"title":"17:17","channel":"Blaze Galaxy","url":"https://www.youtube.com/watch?v=vYESWbYo478&t=128s","duration_raw":"17:17","section_date":"Today","lines":["17:17","Mickey Mouse Clubhouse Characters and their favorite Snacks, Drinks,   Movies & More! | Goofy, Pluto","Blaze Galaxy","124K views"]},{"title":"9:04","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=If8bUnw_X4I&t=22s","duration_raw":"9:04","section_date":"Today","lines":["9:04","SpongeBob SquarePants Characters And Their Favorite SNACKS, DRINKS & (Other Favorites) | Mr. Krabs","Blaze Kingdom","691K views"]},{"title":"18:03","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=Z6m-F05pyZI&t=85s","duration_raw":"18:03","section_date":"Today","lines":["18:03","ðŸ½ Peppa Pig Characters And Their Favorite Snacks Drinks & More! | Evie Pig, Peppa Pig, Mummy Pig","Blaze Kingdom","1.3M views"]},{"title":"5:50","channel":"Genki Park","url":"https://www.youtube.com/watch?v=x4ODGifsN7w&t=29s","duration_raw":"5:50","section_date":"Today","lines":["5:50","Brush Your Teeth - Eat Healthy - Boo Boo - #healthyhabits  - kindergarten learning videos","Genki Park","5.6M views"]},{"title":"6:22","channel":"Genki Park","url":"https://www.youtube.com/watch?v=8uZW6-fukrU&t=114s","duration_raw":"6:22","section_date":"Today","lines":["6:22","Wash your hands -  Brush your teeth - Boo Boo Song -  Healthy Habits - Nursery Rhymes - Kids Songs","Genki Park","356M views"]},{"title":"22:55","channel":"Reading is","url":"https://www.youtube.com/watch?v=fNogleSaFNQ&t=754s","duration_raw":"22:55","section_date":"Today","lines":["22:55","22 min 5 Books of David's adventures - Animated Read Aloud Books","Reading is","1.8M views"]},{"title":"59:33","channel":"AbdallahKids","url":"https://www.youtube.com/watch?v=Nmb1B5t7VKg&t=2452s","duration_raw":"59:33","section_date":"Today","lines":["59:33","Cocomelon Play with JJ  - Full Game Walkthrough","AbdallahKids","329K views"]},{"title":"30:52","channel":"Bright Star Storytime","url":"https://www.youtube.com/watch?v=jrGxQxeAMk8&t=1472s","duration_raw":"30:52","section_date":"Today","lines":["30:52","30 Minutes Leslie Patricelli Storytime Collection|ReadAloud|Toot|pottytrain|Little Libraryprek kids","Bright Star Storytime","150K views"]},{"title":"21:43","channel":"Hoots & Tales","url":"https://www.youtube.com/watch?v=y3hMcoabv2Y&t=296s","duration_raw":"21:43","section_date":"Today","lines":["21:43","Leslie Patricelli Little Library ðŸ“š | Toddler Read-Aloud with Learning Reflections | Hoots and Tales","Hoots & Tales","662K views"]},{"title":"11:17","channel":"Hoots & Tales","url":"https://www.youtube.com/watch?v=kwrXXCAhywI&t=451s","duration_raw":"11:17","section_date":"Today","lines":["11:17","Feelings with Leslie Patricelli ðŸ’› | Toddler Read-Aloud Compilation | Emotions & Empathy","Hoots & Tales","295K views"]},{"title":"51:47","channel":"Bright Star Storytime","url":"https://www.youtube.com/watch?v=wpQDrR7p_Ko&t=361s","duration_raw":"51:47","section_date":"Today","lines":["51:47","1 Hour Leslie Patricelli Storytime Collection| Baby Life, Feelings, Seasons Bedtime Books|Read aloud","Bright Star Storytime","13K views"]},{"title":"9:18","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=TAPYzTJeNGc&t=121s&pp=0gcJCaIKAYcqIYzv","duration_raw":"9:18","section_date":"Today","lines":["9:18","Pinkfong Wonderstar âœ¨ Characters & Their Favorite Drinks, Snacks + More! | Pinkfong & Poki","Blaze Kingdom","137K views"]},{"title":"10:14","channel":"Melon TV Fun","url":"https://www.youtube.com/watch?v=J8y2L6igV80&t=123s","duration_raw":"10:14","section_date":"Today","lines":["10:14","ðŸ¥•ðŸ”¢ Numberblocks Reimagined as Vegetables ðŸŒ½âœ¨ | A Fun Healthy Learning Adventure for Kids!","Melon TV Fun","14K views"]},{"title":"10:41","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=DHkKQZqJOuk&t=389s","duration_raw":"10:41","section_date":"Today","lines":["10:41","Pinkfong Wonderstar â­ In REAL LIFE!ðŸ’« | Mr. Snake's ðŸŽ¬ Favorite Movies, Foods ðŸ• & More | Hogi, Jeni","Blaze Kingdom","1.1M views"]},{"title":"10:16","channel":"Melon TV Fun","url":"https://www.youtube.com/watch?v=SNO60eHLSMs&t=176s","duration_raw":"10:16","section_date":"Today","lines":["10:16","ðŸ”¢Numberblocks Reimagined as Babies! ðŸ¼ðŸ‘¶ | Adorable Math Fun for Kids","Melon TV Fun","2.2M views"]},{"title":"9:04","channel":"Blaze Universe","url":"https://www.youtube.com/watch?v=ocSY07nJ6eU&t=27s","duration_raw":"9:04","section_date":"Today","lines":["9:04","Number BlocksðŸ”¢ Cartoon Characters And Their Favorite Drinks, Movies & More! | Four, One, Zero, Seven","Blaze Universe","764K views"]},{"title":"9:05","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=vFPhrBITX0k","duration_raw":"9:05","section_date":"Today","lines":["9:05","Peppa Pig ðŸ½ Characters and their Favorite Drinks, Fruits & More! | Evie, Peppa, Mummy, Daddy pig","Blaze Kingdom","1M views"]},{"title":"17:41","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=ceUpDI_47nw&t=13s","duration_raw":"17:41","section_date":"Today","lines":["17:41","Baby Panda with Magic Words |  Antonyms & Contrast |  Gameplay Video |  BabyBus Game","BabyBus - Kids Songs and Cartoons","18M views"]},{"title":"54:50","channel":"Warner Bros. Classics","url":"https://www.youtube.com/watch?v=qsKqoYM7uk8&t=157s","duration_raw":"54:50","section_date":"Today","lines":["54:50","Tom and Jerry | Mega Compilation | Vol. 10 | The Spike Series | Warner Classics","Warner Bros. Classics","8.5M views"]},{"title":"6:09","channel":"Adi Connection","url":"https://www.youtube.com/watch?v=oyUyjxmaU_Q&t=200s","duration_raw":"6:09","section_date":"Today","lines":["6:09","100 Action Words in English ðŸ¥³ for Kids | Daily Use Sentences | Adi Keshari Connection","Adi Connection","31K views"]},{"title":"31:15","channel":"Peppa Pig - Official Channel","url":"https://www.youtube.com/watch?v=C1I_8D5NlXw&t=7s","duration_raw":"31:15","section_date":"Today","lines":["31:15","Making Funny Pizza Faces! ðŸ• | Peppa Pig Official Full Episodes","Peppa Pig - Official Channel","13M views"]},{"title":"10:40","channel":"Adi Connection","url":"https://www.youtube.com/watch?v=_bsH6Y_6UrA&pp=0gcJCaIKAYcqIYzv","duration_raw":"10:40","section_date":"Today","lines":["10:40","Let's Do Magic on Glass ðŸŽ¨ DIY Window Art & Craft for Kids | Adi Connection","Adi Connection","54K views"]},{"title":"3:41","channel":"Adi Connection","url":"https://www.youtube.com/watch?v=ulWZioJA9Ig&t=9s","duration_raw":"3:41","section_date":"Today","lines":["3:41","Kids Vocabulary for Everyday Use ðŸ˜±, Learn English with Adi & Mini, Adi Connection","Adi Connection","14K views"]},{"title":"2:28","channel":"Adi Connection","url":"https://www.youtube.com/watch?v=oajFmF32B4k","duration_raw":"2:28","section_date":"Today","lines":["2:28","Guess What I Am ðŸ¤” | English Riddles for Kids | Adi Keshari Connection","Adi Connection","5.5K views"]},{"title":"2:58","channel":"Genki Park","url":"https://www.youtube.com/watch?v=Dx-LG3oCzSM&t=46s","duration_raw":"2:58","section_date":"Today","lines":["2:58","Sick Song | Cartoon for Kids | Nursery Rhymes | Healthy Habits | Genki Park | Be ill Song Toddlers","Genki Park","6.5M views"]},{"title":"8:18","channel":"Sago Mini","url":"https://www.youtube.com/watch?v=2B71s7-_uKk&t=42s","duration_raw":"8:18","section_date":"Today","lines":["8:18","Sago Mini Babies Read Aloud ðŸ“–ðŸ‘¶ | Read Along Stories for Kids | Sago Mini Storytime","Sago Mini","5.1M views"]},{"title":"10:06","channel":"Top Best Apps Planet","url":"https://www.youtube.com/watch?v=g1GYG2REnUU&t=33s","duration_raw":"10:06","section_date":"Today","lines":["10:06","ðŸŽ¹ Baby piano and music games for kids and toddlers ðŸŽ¹","Top Best Apps Planet","537K views"]},{"title":"29:50","channel":"Peppa Pig's Pretend Play","url":"https://www.youtube.com/watch?v=DAyMLvJQiSo&t=28s","duration_raw":"29:50","section_date":"Today","lines":["29:50","Peppa Pig - Learn Numbers With Peppa Pig - Learning with Peppa Pig","Peppa Pig's Pretend Play","3M views"]},{"title":"7:21","channel":"Genki Park","url":"https://www.youtube.com/watch?v=xCJ8eHrNn88&t=122s","duration_raw":"7:21","section_date":"Today","lines":["7:21","Boo Boo Song | Healthy Meal | Sick Song | Healthy Habits | Toddlers | Nursery Rhymes | Germs | Kids","Genki Park","17M views"]},{"title":"6:22","channel":"Genki Park","url":"https://www.youtube.com/watch?v=8uZW6-fukrU&t=114s","duration_raw":"6:22","section_date":"Today","lines":["6:22","Wash your hands -  Brush your teeth - Boo Boo Song -  Healthy Habits - Nursery Rhymes - Kids Songs","Genki Park","356M views"]},{"title":"3:38","channel":"Yrrrech OG 33","url":"https://www.youtube.com/watch?v=SDUhwToRyq0&t=69s","duration_raw":"3:38","section_date":"Today","lines":["3:38","Toca Boca Intro Compilation with Games Icon â¤ï¸â¤ï¸â¤ï¸ðŸ’ðŸ’ðŸ’","Yrrrech OG 33","1.4M views"]},{"title":"2:01","channel":"Sunset Toca â˜€ï¸","url":"https://www.youtube.com/watch?v=Its2Y8Kf3gM","duration_raw":"2:01","section_date":"Today","lines":["2:01","Toca Boca intro EDIT! Check it out, super funny!!!","Sunset Toca â˜€ï¸","2.3M views"]},{"title":"16:23","channel":"Daja Kids Games","url":"https://www.youtube.com/watch?v=y9uTvTgPK-o&t=40s&pp=0gcJCaIKAYcqIYzv","duration_raw":"16:23","section_date":"Today","lines":["16:23","Baby Panda Care -Take Care of the Baby Panda Miu Miu and Help her Grow Up Healthy | BabyBus Games","Daja Kids Games","12M views"]},{"title":"7:03","channel":"Quiz Noke","url":"https://www.youtube.com/watch?v=MVTRLlkiVXQ&t=12s","duration_raw":"7:03","section_date":"Today","lines":["7:03","Guess The Early Learning App Logo Sound ðŸ”ŠðŸ§  | Khan Academy Kids, Duolingo ABC, Sago Mini","Quiz Noke","9.1K views"]},{"title":"39:25","channel":"StoryBoca","url":"https://www.youtube.com/watch?v=Fnt4pkJeDCI&t=55s","duration_raw":"39:25","section_date":"Today","lines":["39:25","EVOLUTION OF TOCA BOCA WORLD | Trailers | New VS Old","StoryBoca","1.5M views"]},{"title":"9:49","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=2q5WbknI_EM&t=7s","duration_raw":"9:49","section_date":"Today","lines":["9:49","Baby Panda Care | Baby Care | Game for Kids |  Kids Cartoon | BabyBus - Kids Songs and Cartoons","BabyBus - Kids Songs and Cartoons","22M views"]},{"title":"6:27","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=HlfRarTcuNI&t=102s","duration_raw":"6:27","section_date":"Today","lines":["6:27","Baby Supermarket Shopping | Pretend Play | Kids Cartoon | Animation For Kids | BabyBus","BabyBus - Kids Songs and Cartoons","9.9M views"]},{"title":"11:36","channel":"KidsBabyBus HD","url":"https://www.youtube.com/watch?v=RSOiMFH8duo&t=6s","duration_raw":"11:36","section_date":"Today","lines":["11:36","Baby Panda's Safety Journey: Learn Crucial Safety Tips at Home & While Traveling - Educational Game","KidsBabyBus HD","28M views"]},{"title":"10:25","channel":"Sago Fun Games for Kids","url":"https://www.youtube.com/watch?v=fJSs3myiNXY&t=30s","duration_raw":"10:25","section_date":"Today","lines":["10:25","NEW! Sago Mini School FULL | Kitchen, Rainbows | Kids Game Preschool","Sago Fun Games for Kids","915K views"]},{"title":"10:18","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=706c5-Ndvi0&t=141s","duration_raw":"10:18","section_date":"Today","lines":["10:18","Feelings - Emotional Growth | Learn to understand others' feelings | BabyBus Kids Games","BabyBus - Kids Songs and Cartoons","45M views"]},{"title":"11:35","channel":"Gameplay Everyday","url":"https://www.youtube.com/watch?v=OtxhOK3pxCA&t=19s","duration_raw":"11:35","section_date":"Today","lines":["11:35","New bandmaster game on Piano Kids game - Music maestro game for kids - Educational game for kids","Gameplay Everyday","607K views"]},{"title":"1:30:06","channel":"XCageGame","url":"https://www.youtube.com/watch?v=GyehualmD2I&t=1541s","duration_raw":"1:30:06","section_date":"Today","lines":["1:30:06","My Friend Peppa Pig Full PS5 Gameplay Walkthrough (Longplay) Next Gen Upgrade","XCageGame","192K views"]},{"title":"2:13:18","channel":"Game Vault","url":"https://www.youtube.com/watch?v=iEGppWmntaU&t=1862s","duration_raw":"2:13:18","section_date":"Today","lines":["2:13:18","my friend Peppa pig (PC) Longplay","Game Vault","143K views"]},{"title":"3:28:51","channel":"Games and fun with Palmi & Mino","url":"https://www.youtube.com/watch?v=VLkPumasbCY&t=1333s","duration_raw":"3:28:51","section_date":"Today","lines":["3:28:51","Peppa Pig World Adventures | Full Gameplay | Walkthrough | 100% | No Commentary | ENGLISH","Games and fun with Palmi & Mino","611K views"]},{"title":"9:01","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=mMeYuHS8UM8&t=25s","duration_raw":"9:01","section_date":"Today","lines":["9:01","Numberblocks and Their Favorite Snacks, Drinks, Movies & More! | One, Two, Three","Blaze Kingdom","431K views"]},{"title":"2:13","channel":"Blaze Toon","url":"https://www.youtube.com/watch?v=wQPivCaYqmI","duration_raw":"2:13","section_date":"Today","lines":["2:13","NUMBER BLOCKS CHARACTERS AND THEIR FAVORITE YOUTUBE SERIES!","Blaze Toon","709K views"]},{"title":"2:58","channel":"Natural English","url":"https://www.youtube.com/watch?v=pUPM3DtK9so&t=4s&pp=0gcJCaIKAYcqIYzv","duration_raw":"2:58","section_date":"Today","lines":["2:58","The Colors Song ~ Learn the Colors / Colours ~ LEARN ENGLISH with Natural English ~ LEARN VOCABULARY","Natural English","135M views"]},{"title":"30:52","channel":"Bright Star Storytime","url":"https://www.youtube.com/watch?v=jrGxQxeAMk8&t=1472s","duration_raw":"30:52","section_date":"Today","lines":["30:52","30 Minutes Leslie Patricelli Storytime Collection|ReadAloud|Toot|pottytrain|Little Libraryprek kids","Bright Star Storytime","150K views"]},{"title":"9:23","channel":"Hoots & Tales","url":"https://www.youtube.com/watch?v=hsPoVXIsV4Q&t=116s","duration_raw":"9:23","section_date":"Today","lines":["9:23","Bedtime with Leslie Patricelli ðŸŒ™ | Toddler Read-Aloud Compilation | Comfort & Routines","Hoots & Tales","147K views"]},{"title":"16:07","channel":"Great Quiz","url":"https://www.youtube.com/watch?v=wbR8eUYukEM","duration_raw":"16:07","section_date":"Today","lines":["16:07","Pinkfong Wonderstar Characters In REAL LIFE! | ðŸŽ¬ Favorite Movies, Foods ðŸ• & More | Hogi, Jeni...","Great Quiz","845K views"]},{"title":"15:26","channel":"Great Quiz","url":"https://www.youtube.com/watch?v=a5jBK5cXwb0&t=78s","duration_raw":"15:26","section_date":"Today","lines":["15:26","Little Baby Bum in REAL LIFE ðŸ‘©â­ + Guess The Voice Quiz ~ Mia, Max, Twinkle Twinkle Little Star...","Great Quiz","285K views"]},{"title":"34:08","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=5EGmizOPnkk&t=20s&pp=0gcJCaIKAYcqIYzv","duration_raw":"34:08","section_date":"Today","lines":["34:08","Baby Panda's Candy Shop was Stolen | Baby Panda Sheriff | Policeman Pretend Play | BabyBus","BabyBus - Kids Songs and Cartoons","26M views"]},{"title":"23:47","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=eWmC4G9tG-4&t=106s","duration_raw":"23:47","section_date":"Today","lines":["23:47","Neo Needs to Go Potty! | My Turn My Turn | Good Habits | Nursery Rhymes & Kids Songs | BabyBus","BabyBus - Kids Songs and Cartoons","11M views"]},{"title":"5:01","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=KIZoqJHshTI&t=27s","duration_raw":"5:01","section_date":"Today","lines":["5:01","Take Care of Little Baby ðŸ‘¶ | Kids Cartoon | Animation For Kids | Nursery Rhymes | BabyBus","BabyBus - Kids Songs and Cartoons","54M views"]},{"title":"4:32","channel":"TocaFun","url":"https://www.youtube.com/watch?v=Q4xHOeFXYvU&t=56s","duration_raw":"4:32","section_date":"Today","lines":["4:32","Minions are watching Toca Boca Intros for 4min. | TocaFunðŸ˜˜","TocaFun","1.8M views"]},{"title":"23:49","channel":"GamePlay Adventure","url":"https://www.youtube.com/watch?v=5oV_sKr7quU&t=12s","duration_raw":"23:49","section_date":"Today","lines":["23:49","Peppa Pig Golden Boots,Fun Fair,Happy Mrs Chicken,Holiday,Sports Day, Party Time,Polly Parrot,Hippo","GamePlay Adventure","75K views"]},{"title":"10:05","channel":"Peppa's Best Bites","url":"https://www.youtube.com/watch?v=Ek6NnCT_Hng&t=15s&pp=0gcJCaIKAYcqIYzv","duration_raw":"10:05","section_date":"Today","lines":["10:05","Peppa Pig Official Channel | Making Birthday Cake with Peppa Pig","Peppa's Best Bites","8.4M views"]},{"title":"10:50","channel":"Peppa Pig's Pretend Play","url":"https://www.youtube.com/watch?v=yi56hE8fQD4&t=419s","duration_raw":"10:50","section_date":"Today","lines":["10:50","Peppa Pig - Dress up Peppa Pig - Learn Colouring - Learning with Peppa Pig","Peppa Pig's Pretend Play","104M views"]},{"title":"11:37","channel":"KidsBabyBus HD","url":"https://www.youtube.com/watch?v=1XwNIejlMkk&t=18s","duration_raw":"11:37","section_date":"Today","lines":["11:37","Drive My Cool School Bus: Ready for a Fun Ride to School?","KidsBabyBus HD","77K views"]},{"title":"5:44","channel":"Master's 10k","url":"https://www.youtube.com/watch?v=wm30tw097Vg&t=16s","duration_raw":"5:44","section_date":"Today","lines":["5:44","Kids Learn How to Share | My Turn My Turn | Sharing Song | Nursery Rhyme & Kids Songs | BabyBus","Master's 10k","10K views"]},{"title":"22:08","channel":"ROBIXX GAMING","url":"https://www.youtube.com/watch?v=KAIwHmIs3WE&t=11s","duration_raw":"22:08","section_date":"Today","lines":["22:08","Baby Panda School Bus #1 - Gameplay Walkthrough","ROBIXX GAMING","38K views"]},{"title":"3:11","channel":"FunToyLand - Toys & Learning","url":"https://www.youtube.com/watch?v=sco8lUG_7Lw&t=27s","duration_raw":"3:11","section_date":"Today","lines":["3:11","Peppa Pig ABC Dance Song","FunToyLand - Toys & Learning","6.4M views"]},{"title":"9:05","channel":"Kidzstation Fun Academy","url":"https://www.youtube.com/watch?v=7W9dQIyikU0&t=14s","duration_raw":"9:05","section_date":"Today","lines":["9:05","Learn Alphabets A to Z with Peppa Pig | Kidzstation Fun Academy","Kidzstation Fun Academy","24M views"]},{"title":"10:15","channel":"Kidsquad","url":"https://www.youtube.com/watch?v=3nOafpZKybc&t=304s","duration_raw":"10:15","section_date":"Today","lines":["10:15","Peppa English Episodes | Peppa Pig Alphabet | Peppa Pig Characters | Learn With Peppa Pig | ABCD","Kidsquad","874K views"]},{"title":"3:22","channel":"Kidsquad","url":"https://www.youtube.com/watch?v=KAF2x31_bSE&t=30s","duration_raw":"3:22","section_date":"Today","lines":["3:22","Peppa Pig Characters | Peppa Pig Characters in Real life | Learn Animals With Peppa And George |","Kidsquad","12M views"]},{"title":"15:34","channel":"Learn English on a Daily Basis","url":"https://www.youtube.com/watch?v=Dpa7lCYg6iM&t=24s","duration_raw":"15:34","section_date":"Today","lines":["15:34","Kids Learn 123 Counting Numbers from 1 to 10 with Elmo Loves 123s Part 1 â€“ Play Doh Games","Learn English on a Daily Basis","1.3M views"]},{"title":"5:48","channel":"Shall We Read A Book?","url":"https://www.youtube.com/watch?v=NL3AZ57hqh8&t=63s","duration_raw":"5:48","section_date":"Today","lines":["5:48","Cocomelon Little Pocket Library: Read Aloud 6 Book Collection for Children and Toddlers","Shall We Read A Book?","54M views"]},{"title":"24:11","channel":"Hoots & Tales","url":"https://www.youtube.com/watch?v=bGAI78WI_pg&t=39s","duration_raw":"24:11","section_date":"Today","lines":["24:11","4 Big Box of Books ðŸ“š | CoComelon, Peppa, Bluey & More | Family & Friends Read Aloud Stories","Hoots & Tales","1M views"]},{"title":"15:45","channel":"Gerrard","url":"https://www.youtube.com/watch?v=JUA2VHuwtw0&t=33s&pp=0gcJCaIKAYcqIYzv","duration_raw":"15:45","section_date":"Today","lines":["15:45","How To Make PBS Kids Dash Logo Effects Sponsored By Preview 2 Effects On KineMaster","Gerrard","786K views"]},{"title":"7:06","channel":"Tye The Cool Guy","url":"https://www.youtube.com/watch?v=l3H5Jqcp-1Q&t=32s","duration_raw":"7:06","section_date":"Today","lines":["7:06","PBS Kids ID (I Voice Del, Dee & Dot)","Tye The Cool Guy","1.9M views"]},{"title":"5:37","channel":"Peeebs","url":"https://www.youtube.com/watch?v=2sQ1JQKrOe4&t=21s&pp=0gcJCaIKAYcqIYzv","duration_raw":"5:37","section_date":"Today","lines":["5:37","PBS Kids ID / System Cue Compilation (1999-2022)","Peeebs","36M views"]},{"title":"10:16","channel":"BabyBus - Kids Songs and Cartoons","url":"https://www.youtube.com/watch?v=tN6q6HuU3r0&t=14s","duration_raw":"10:16","section_date":"Today","lines":["10:16","My Kindergarten - Panda Gamesï½œFall in love Kindergartenï½œTo overcome the psychological fear","BabyBus - Kids Songs and Cartoons","1.2M views"]},{"title":"18:43","channel":"Peppa Pig - Official Channel","url":"https://www.youtube.com/watch?v=2Mxs3VDxQfI&t=18s","duration_raw":"18:43","section_date":"Today","lines":["18:43","Peppa Pig - Happy Mrs Chicken gameplay (app demo)","Peppa Pig - Official Channel","1.9M views"]},{"title":"19:42","channel":"Little Wonders TV","url":"https://www.youtube.com/watch?v=zrrvo9NkS1I&pp=0gcJCaIKAYcqIYzv","duration_raw":"19:42","section_date":"Today","lines":["19:42","Peppa Pig Goes Shopping ðŸ· Peppa Pig Shopping Gameplay","Little Wonders TV","11M views"]},{"title":"8:07","channel":"Nintendo Games","url":"https://www.youtube.com/watch?v=W90rAfCVfBM&t=358s","duration_raw":"8:07","section_date":"Today","lines":["8:07","Unboxing - CoComelon: Play with JJ - Nintendo Switch | Walkthrough | Kids Game","Nintendo Games","243K views"]},{"title":"34:44","channel":"Handheld Players","url":"https://www.youtube.com/watch?v=jMsV_Raowys&t=743s","duration_raw":"34:44","section_date":"Today","lines":["34:44","Peppa Pig: World Adventures Nintendo Switch Gameplay","Handheld Players","47K views"]},{"title":"52:49","channel":"Little Wonders TV","url":"https://www.youtube.com/watch?v=nxHH-NQMcWQ","duration_raw":"52:49","section_date":"Today","lines":["52:49","PEPPA PIG WORLD ADVENTURES GAMEPLAY","Little Wonders TV","97K views"]},{"title":"2:29:22","channel":"rrvirus","url":"https://www.youtube.com/watch?v=eCikDTKH3r4&t=6293s&pp=0gcJCaIKAYcqIYzv","duration_raw":"2:29:22","section_date":"Today","lines":["2:29:22","Peppa Pig: World Adventures - Full Movie Gameplay","rrvirus","130K views"]},{"title":"9:05","channel":"Blaze Kingdom","url":"https://www.youtube.com/watch?v=vFPhrBITX0k","duration_raw":"9:05","section_date":"Today","lines":["9:05","Peppa Pig ðŸ½ Characters and their Favorite Drinks, Fruits & More! | Evie, Peppa, Mummy, Daddy pig","Blaze Kingdom","1M views"]},{"title":"3:06","channel":"Bright Star Storytime","url":"https://www.youtube.com/watch?v=7AI_tiXPt3o&t=26s","duration_raw":"3:06","section_date":"Today","lines":["3:06","Doggie Gets Scared | Leslie Patricelli | Animated Read Aloud for Kids | Emotions & Feelings preK","Bright Star Storytime","1.6K views"]},{"title":"13:05","channel":"Bright Star Storytime","url":"https://www.youtube.com/watch?v=tzjDOoOZpZE&t=23s","duration_raw":"13:05","section_date":"Today","lines":["13:05","Leslie Patricelli Opposites Collection 13 Min | Animated Storytime for Toddlers & PreK | Read Aloud","Bright Star Storytime","40K views"]},{"title":"15:32","channel":"Nintendo Games","url":"https://www.youtube.com/watch?v=ZWBNJVFMcU8&t=656s","duration_raw":"15:32","section_date":"Today","lines":["15:32","CoComelon: Play with JJ | Gameplay | Nintendo Switch","Nintendo Games","449K views"]},{"title":"13:59","channel":"StoryBoca","url":"https://www.youtube.com/watch?v=I9Ih_IBp-L0&t=36s","duration_raw":"13:59","section_date":"Today","lines":["13:59","INTRO & TRAILERS OF TOCA BOCA | TOCA BOCA GAMES","StoryBoca","1.2M views"]},{"title":"4:40","channel":"StoryBoca","url":"https://www.youtube.com/watch?v=QmaLI2aA-dg","duration_raw":"4:40","section_date":"Today","lines":["4:40","TOCA BOCA INTRO COMPILATION WITH LOGO and Name ðŸ˜â¤ï¸â€ðŸ”¥","StoryBoca","5.7M views"]}]

ET = timezone(timedelta(hours=-5))
NOW = datetime(2026, 2, 20, 20, 0, 0, tzinfo=ET)


def parse_duration_seconds(raw: str) -> int:
    """Convert 'HH:MM:SS' or 'MM:SS' to seconds."""
    parts = raw.strip().split(":")
    try:
        if len(parts) == 3:
            return int(parts[0]) * 3600 + int(parts[1]) * 60 + int(parts[2])
        elif len(parts) == 2:
            return int(parts[0]) * 60 + int(parts[1])
    except Exception:
        pass
    return 0


def section_to_iso(section_date: str) -> str:
    if section_date == "Today":
        d = NOW.date()
    elif section_date == "Yesterday":
        d = (NOW - timedelta(days=1)).date()
    else:
        d = NOW.date()
    return datetime(d.year, d.month, d.day, 12, 0, 0, tzinfo=ET).isoformat()


# Build clean video list â€” fix titles (lines[1] when lines[0] is duration)
seen_urls = set()
videos = []
for v in RAW_VIDEOS:
    url_key = v["url"].split("&t=")[0].split("&pp=")[0]
    if url_key in seen_urls:
        continue
    seen_urls.add(url_key)

    lines = v.get("lines", [])
    # lines[0] = duration badge, lines[1] = title, lines[2] = channel
    title = lines[1] if len(lines) > 1 else v["title"]
    channel = v["channel"]
    duration_secs = parse_duration_seconds(v["duration_raw"])

    videos.append({
        "title": title,
        "channel": channel,
        "url": v["url"],
        "duration_raw": v["duration_raw"],
        "duration_seconds": duration_secs,
        "timestamp": section_to_iso(v["section_date"]),
        "section_date": v["section_date"],
    })

# Stats
total_seconds = sum(v["duration_seconds"] for v in videos)
channel_counts = Counter(v["channel"] for v in videos)
top_channels = [{"channel": ch, "count": cnt} for ch, cnt in channel_counts.most_common(10)]

# Categories (rough)
def categorize(v):
    title_lower = v["title"].lower()
    channel_lower = v["channel"].lower()
    if any(k in title_lower for k in ["read aloud", "storytime", "story time", "book"]):
        return "Read Aloud / Storytime"
    if any(k in title_lower for k in ["gameplay", "walkthrough", "game", "longplay"]):
        return "Game Walkthroughs"
    if any(k in title_lower for k in ["learn", "alphabet", "abc", "counting", "numbers", "colors", "shapes", "vocabulary", "english"]):
        return "Educational"
    if any(k in title_lower for k in ["healthy habits", "potty", "brush", "wash", "nursery rhyme", "song", "boo boo", "sick"]):
        return "Songs / Healthy Habits"
    if any(k in title_lower for k in ["real life", "quiz", "favorite", "snacks", "drinks"]):
        return "Character Quizzes / Real Life"
    if any(k in channel_lower for k in ["peppa", "babybus", "cocomelon", "numberblock"]):
        return "Kids Shows / Cartoons"
    if any(k in title_lower for k in ["toca boca", "intro", "compilation", "logo"]):
        return "Intros / Compilations"
    return "Other"

cat_counts = Counter(categorize(v) for v in videos)
top_categories = [{"category": cat, "count": cnt} for cat, cnt in cat_counts.most_common()]

# All from "Today" (Feb 20), assign hours spread across the day
hourly_counts = {str(h): 0 for h in range(24)}
daily_counts = {"Mon": 0, "Tue": 0, "Wed": 0, "Thu": 0, "Fri": 0, "Sat": 0, "Sun": 0}
daily_counts["Thu"] = len(videos)  # Feb 20, 2026 is a Friday
daily_counts["Fri"] = len(videos)
daily_counts["Thu"] = 0
# Feb 20 2026 is a Friday
for i, v in enumerate(videos):
    # spread across 8am-8pm
    hour = 8 + (i * 12 // len(videos))
    hourly_counts[str(hour)] = hourly_counts.get(str(hour), 0) + 1
daily_counts["Fri"] = len(videos)

result = {
    "generated": NOW.isoformat(),
    "account": "jigar.us.af@gmail.com",
    "period_days": 7,
    "note": "Daily update",
    "total_videos": len(videos),
    "total_watch_minutes": round(total_seconds / 60, 1),
    "videos": videos,
    "top_channels": top_channels,
    "top_categories": top_categories,
    "hourly_counts": hourly_counts,
    "daily_counts": daily_counts,
}

out = Path("/Users/sgtclaw/.openclaw/workspace/KidWatch/data/history.json")
out.write_text(json.dumps(result, indent=2, ensure_ascii=False))
print(f"âœ… Wrote {len(videos)} videos, {round(total_seconds/60,1)} watch minutes")
print(f"Top channels: {top_channels[:5]}")
